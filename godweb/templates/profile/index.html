{% extends 'base.html' %}

{% block title %}Trang cá nhân - GodWeb{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1><i class="fas fa-user-circle"></i> Trang cá nhân</h1>
        <p>Quản lý thông tin tài khoản của bạn</p>
    </div>
</div>

<section class="section">
    <div class="container">
        <div class="profile-layout">
            <!-- Sidebar -->
            <div>
                <div class="card" style="padding: 30px; text-align: center;">
                    <div style="position: relative; width: 100px; height: 100px; margin: 0 auto 20px;">
                        <div style="width: 100px; height: 100px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 40px;">
                            <i class="fas fa-user"></i>
                        </div>
                        <div style="position: absolute; bottom: -5px; right: -5px; background: var(--secondary-color); color: white; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: bold;">
                            ID #{{ current_user.id }}
                        </div>
                    </div>
                    <h3>{{ current_user.username }}</h3>
                    <p style="color: var(--text-light);">{{ current_user.email }}</p>
                    <div style="margin-top: 10px; display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;">
                        <span class="filter-tag">{{ 'Admin' if current_user.is_admin() else 'User' }}</span>
                        <span class="filter-tag" style="background: var(--secondary-color); color: white; border-color: var(--secondary-color);">
                            <i class="fas fa-id-card"></i> #{{ current_user.id }}
                        </span>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px; padding: 0;">
                    <div class="sidebar-menu">
                        <a href="{{ url_for('profile.index') }}" class="active"><i class="fas fa-home"></i> Tổng quan</a>
                        <a href="{{ url_for('profile.edit') }}"><i class="fas fa-edit"></i> Chỉnh sửa hồ sơ</a>
                        <a href="{{ url_for('wallet.index') }}"><i class="fas fa-wallet"></i> Ví GodCoin</a>
                        <a href="{{ url_for('profile.orders') }}"><i class="fas fa-shopping-bag"></i> Lịch sử mua hàng</a>
                        <a href="{{ url_for('profile.purchases') }}"><i class="fas fa-newspaper"></i> Bài viết đã mua</a>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div>
                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card primary">
                        <h3>Số dư GodCoin</h3>
                        <div class="value">{{ current_user.godcoin_balance }}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Đơn hàng</h3>
                        <div class="value">{{ orders | length }}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Giao dịch</h3>
                        <div class="value">{{ transactions | length }}</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card" style="padding: 25px; margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px;"><i class="fas fa-bolt"></i> Hành động nhanh</h3>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <a href="{{ url_for('wallet.topup') }}" class="btn btn-secondary">
                            <i class="fas fa-coins"></i> Nạp GodCoin
                        </a>
                        <a href="{{ url_for('store.index') }}" class="btn btn-primary">
                            <i class="fas fa-shopping-cart"></i> Mua sản phẩm
                        </a>
                        <a href="{{ url_for('blog.index') }}" class="btn btn-outline">
                            <i class="fas fa-book"></i> Đọc Blog
                        </a>
                    </div>
                </div>

                <!-- Recent Transactions -->
                <div class="card" style="padding: 25px; margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px;"><i class="fas fa-history"></i> Giao dịch gần đây</h3>
                    {% if transactions %}
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Loại</th>
                                    <th>Số lượng</th>
                                    <th>Mô tả</th>
                                    <th>Thời gian</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for trans in transactions %}
                                <tr>
                                    <td>
                                        {% if trans.amount > 0 %}
                                        <span style="color: var(--success-color);"><i class="fas fa-plus-circle"></i></span>
                                        {% else %}
                                        <span style="color: var(--danger-color);"><i class="fas fa-minus-circle"></i></span>
                                        {% endif %}
                                    </td>
                                    <td style="color: {% if trans.amount > 0 %}var(--success-color){% else %}var(--danger-color){% endif %}; font-weight: 600;">
                                        {% if trans.amount > 0 %}+{% endif %}{{ trans.amount }} GC
                                    </td>
                                    <td>{{ trans.description }}</td>
                                    <td>{{ trans.created_at.strftime('%d/%m/%Y') }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p style="color: var(--text-light); text-align: center;">Chưa có giao dịch nào</p>
                    {% endif %}
                </div>

                <!-- Recent Orders -->
                <div class="card" style="padding: 25px;">
                    <h3 style="margin-bottom: 20px;"><i class="fas fa-shopping-bag"></i> Đơn hàng gần đây</h3>
                    {% if orders %}
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Sản phẩm</th>
                                    <th>Giá</th>
                                    <th>Ngày mua</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for order in orders %}
                                <tr>
                                    <td>{{ order.product.name }}</td>
                                    <td><span class="card-price"><i class="fas fa-coins"></i> {{ order.price }} GC</span></td>
                                    <td>{{ order.created_at.strftime('%d/%m/%Y') }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p style="color: var(--text-light); text-align: center;">Chưa có đơn hàng nào</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
